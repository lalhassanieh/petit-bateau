{{ 'my-account.css' | asset_url | stylesheet_tag }}

<div class="customer-register">
  <div class="container">
    <div
      class="customer-form register-form w-full max-w-custom m-auto col-sm-w-custom"
      style="--col-width: 80%; --max-width: 63rem"
    >
      {% form 'create_customer', class: 'custormer-register-form' %}
        {%- if form.errors -%}
          <ul class="error error-list flex flex-wrap">
            {%- render 'icon-error' -%}
            {%- for field in form.errors -%}
              <li class="flex gap-5 align-center flex-wrap">
                {%- if field == 'form' -%}
                  {{ form.errors.messages[field] | append: '.' }}
                {%- else -%}
                  <a href="#RegisterForm-{{ field }}" class="link link-underline no-underline">
                    <span class="text">
                      {{ form.errors.translated_fields[field] | capitalize }}
                      {{ form.errors.messages[field] | append: '.' }}
                    </span>
                  </a>
                {% endif %}
              </li>
            {%- endfor -%}
          </ul>
        {% endif %}
        <div class="form-group mb-20 flex flex-column first-name form-floating">         
          <input
            type="text"
            id="first-name"
             class="form-control"
            placeholder="{{ 'customer.register.first_name' | t }}"
            name="customer[first_name]"
            required
          >
          <label class="form-label pb-5" for="first-name">
            {{- 'customer.register.first_name' | t -}}
          </label>
        </div>
        <div class="form-group mb-20 flex flex-column last-name form-floating"> 
          <input
            type="text"
            id="last-name"
            class="form-control"
            name="customer[last_name]"
            placeholder="{{ 'customer.register.last_name' | t }}"
            required
          >
        <label class="form-label pb-5" for="last-name">{{ 'customer.register.last_name' | t }}</label>
        </div>
        <div class="form-group mb-20 flex flex-column email form-floating">
          <input
            type="email"
            name="customer[email]"
            placeholder="{{ 'customer.login_page.placeholder_email' | t }}"
            required
            id="email"
             class="form-control"
          >
          <label class="pb-5" for="email">
            {{- 'customer.register.email' | t -}}
            <span class="required">*</span></label
          >
        </div>
        <div class="form-group mb-20 flex flex-column phone">
          <label class="form-label pb-5">
            {{ 'customer.register.phone' | t | default: 'TÃ©lÃ©phone' }}
          </label>
          <div class="phone-input-wrapper flex gap-2">
            <select name="customer[phone_country]" class="country-select form-control" style="flex: 0 0 120px;">
              <option value="+961" selected>ğŸ‡±ğŸ‡§ +961</option>
              <option value="+33">ğŸ‡«ğŸ‡· +33</option>
              <option value="+1">ğŸ‡ºğŸ‡¸ +1</option>
              <option value="+1">ğŸ‡¨ğŸ‡¦ +1</option>
              <option value="+44">ğŸ‡¬ğŸ‡§ +44</option>
              <option value="+49">ğŸ‡©ğŸ‡ª +49</option>
              <option value="+39">ğŸ‡®ğŸ‡¹ +39</option>
              <option value="+34">ğŸ‡ªğŸ‡¸ +34</option>
              <option value="+31">ğŸ‡³ğŸ‡± +31</option>
              <option value="+32">ğŸ‡§ğŸ‡ª +32</option>
              <option value="+41">ğŸ‡¨ğŸ‡­ +41</option>
              <option value="+43">ğŸ‡¦ğŸ‡¹ +43</option>
              <option value="+351">ğŸ‡µğŸ‡¹ +351</option>
              <option value="+352">ğŸ‡±ğŸ‡º +352</option>
              <option value="+45">ğŸ‡©ğŸ‡° +45</option>
              <option value="+46">ğŸ‡¸ğŸ‡ª +46</option>
              <option value="+47">ğŸ‡³ğŸ‡´ +47</option>
              <option value="+358">ğŸ‡«ğŸ‡® +358</option>
              <option value="+354">ğŸ‡®ğŸ‡¸ +354</option>
              <option value="+353">ğŸ‡®ğŸ‡ª +353</option>
              <option value="+48">ğŸ‡µğŸ‡± +48</option>
              <option value="+420">ğŸ‡¨ğŸ‡¿ +420</option>
              <option value="+421">ğŸ‡¸ğŸ‡° +421</option>
              <option value="+36">ğŸ‡­ğŸ‡º +36</option>
              <option value="+385">ğŸ‡­ğŸ‡· +385</option>
              <option value="+386">ğŸ‡¸ğŸ‡® +386</option>
              <option value="+372">ğŸ‡ªğŸ‡ª +372</option>
              <option value="+371">ğŸ‡±ğŸ‡» +371</option>
              <option value="+370">ğŸ‡±ğŸ‡¹ +370</option>
              <option value="+30">ğŸ‡¬ğŸ‡· +30</option>
              <option value="+90">ğŸ‡¹ğŸ‡· +90</option>
              <option value="+7">ğŸ‡·ğŸ‡º +7</option>
              <option value="+380">ğŸ‡ºğŸ‡¦ +380</option>
              <option value="+375">ğŸ‡§ğŸ‡¾ +375</option>
              <option value="+40">ğŸ‡·ğŸ‡´ +40</option>
              <option value="+359">ğŸ‡§ğŸ‡¬ +359</option>
              <option value="+381">ğŸ‡·ğŸ‡¸ +381</option>
              <option value="+382">ğŸ‡²ğŸ‡ª +382</option>
              <option value="+387">ğŸ‡§ğŸ‡¦ +387</option>
              <option value="+389">ğŸ‡²ğŸ‡° +389</option>
              <option value="+383">ğŸ‡½ğŸ‡° +383</option>
              <option value="+355">ğŸ‡¦ğŸ‡± +355</option>
              <option value="+377">ğŸ‡²ğŸ‡¨ +377</option>
              <option value="+378">ğŸ‡¸ğŸ‡² +378</option>
              <option value="+379">ğŸ‡»ğŸ‡¦ +379</option>
              <option value="+376">ğŸ‡¦ğŸ‡© +376</option>
              <option value="+423">ğŸ‡±ğŸ‡® +423</option>
              <option value="+298">ğŸ‡«ğŸ‡´ +298</option>
              <option value="+299">ğŸ‡¬ğŸ‡± +299</option>
              <option value="+508">ğŸ‡µğŸ‡² +508</option>
              <option value="+590">ğŸ‡¬ğŸ‡µ +590</option>
              <option value="+594">ğŸ‡¬ğŸ‡« +594</option>
              <option value="+596">ğŸ‡²ğŸ‡¶ +596</option>
              <option value="+262">ğŸ‡·ğŸ‡ª +262</option>
              <option value="+262">ğŸ‡¾ğŸ‡¹ +262</option>
              <option value="+687">ğŸ‡³ğŸ‡¨ +687</option>
              <option value="+689">ğŸ‡µğŸ‡« +689</option>
              <option value="+681">ğŸ‡¼ğŸ‡« +681</option>
              <option value="+685">ğŸ‡¼ğŸ‡¸ +685</option>
              <option value="+684">ğŸ‡¦ğŸ‡¸ +684</option>
              <option value="+683">ğŸ‡³ğŸ‡º +683</option>
              <option value="+682">ğŸ‡¨ğŸ‡° +682</option>
              <option value="+680">ğŸ‡µğŸ‡¼ +680</option>
              <option value="+679">ğŸ‡«ğŸ‡¯ +679</option>
              <option value="+678">ğŸ‡»ğŸ‡º +678</option>
              <option value="+677">ğŸ‡¸ğŸ‡§ +677</option>
              <option value="+676">ğŸ‡¹ğŸ‡´ +676</option>
              <option value="+675">ğŸ‡µğŸ‡¬ +675</option>
              <option value="+674">ğŸ‡³ğŸ‡· +674</option>
              <option value="+673">ğŸ‡§ğŸ‡³ +673</option>
              <option value="+672">ğŸ‡¦ğŸ‡¶ +672</option>
              <option value="+670">ğŸ‡¹ğŸ‡± +670</option>
              <option value="+668">ğŸ‡µğŸ‡² +668</option>
              <option value="+667">ğŸ‡¬ğŸ‡º +667</option>
              <option value="+666">ğŸ‡µğŸ‡² +666</option>
              <option value="+665">ğŸ‡µğŸ‡² +665</option>
              <option value="+664">ğŸ‡²ğŸ‡¸ +664</option>
              <option value="+91">ğŸ‡®ğŸ‡³ +91</option>
              <option value="+86">ğŸ‡¨ğŸ‡³ +86</option>
              <option value="+81">ğŸ‡¯ğŸ‡µ +81</option>
              <option value="+82">ğŸ‡°ğŸ‡· +82</option>
              <option value="+852">ğŸ‡­ğŸ‡° +852</option>
              <option value="+853">ğŸ‡²ğŸ‡´ +853</option>
              <option value="+886">ğŸ‡¹ğŸ‡¼ +886</option>
              <option value="+65">ğŸ‡¸ğŸ‡¬ +65</option>
              <option value="+60">ğŸ‡²ğŸ‡¾ +60</option>
              <option value="+66">ğŸ‡¹ğŸ‡­ +66</option>
              <option value="+84">ğŸ‡»ğŸ‡³ +84</option>
              <option value="+62">ğŸ‡®ğŸ‡© +62</option>
              <option value="+63">ğŸ‡µğŸ‡­ +63</option>
              <option value="+61">ğŸ‡¦ğŸ‡º +61</option>
              <option value="+64">ğŸ‡³ğŸ‡¿ +64</option>
              <option value="+27">ğŸ‡¿ğŸ‡¦ +27</option>
              <option value="+212">ğŸ‡²ğŸ‡¦ +212</option>
              <option value="+213">ğŸ‡©ğŸ‡¿ +213</option>
              <option value="+216">ğŸ‡¹ğŸ‡³ +216</option>
              <option value="+218">ğŸ‡±ğŸ‡¾ +218</option>
              <option value="+222">ğŸ‡²ğŸ‡· +222</option>
              <option value="+253">ğŸ‡©ğŸ‡¯ +253</option>
              <option value="+252">ğŸ‡¸ğŸ‡´ +252</option>
              <option value="+269">ğŸ‡°ğŸ‡² +269</option>
              <option value="+20">ğŸ‡ªğŸ‡¬ +20</option>
              <option value="+966">ğŸ‡¸ğŸ‡¦ +966</option>
              <option value="+971">ğŸ‡¦ğŸ‡ª +971</option>
              <option value="+965">ğŸ‡°ğŸ‡¼ +965</option>
              <option value="+974">ğŸ‡¶ğŸ‡¦ +974</option>
              <option value="+968">ğŸ‡´ğŸ‡² +968</option>
              <option value="+973">ğŸ‡§ğŸ‡­ +973</option>
              <option value="+964">ğŸ‡®ğŸ‡¶ +964</option>
              <option value="+962">ğŸ‡¯ğŸ‡´ +962</option>
              <option value="+963">ğŸ‡¸ğŸ‡¾ +963</option>
              <option value="+970">ğŸ‡µğŸ‡¸ +970</option>
              <option value="+967">ğŸ‡¾ğŸ‡ª +967</option>
              <option value="+249">ğŸ‡¸ğŸ‡© +249</option>
              <option value="+251">ğŸ‡ªğŸ‡¹ +251</option>
              <option value="+254">ğŸ‡°ğŸ‡ª +254</option>
              <option value="+255">ğŸ‡¹ğŸ‡¿ +255</option>
              <option value="+256">ğŸ‡ºğŸ‡¬ +256</option>
              <option value="+250">ğŸ‡·ğŸ‡¼ +250</option>
              <option value="+257">ğŸ‡§ğŸ‡® +257</option>
              <option value="+258">ğŸ‡²ğŸ‡¿ +258</option>
              <option value="+260">ğŸ‡¿ğŸ‡² +260</option>
              <option value="+263">ğŸ‡¿ğŸ‡¼ +263</option>
              <option value="+264">ğŸ‡³ğŸ‡¦ +264</option>
              <option value="+266">ğŸ‡±ğŸ‡¸ +266</option>
              <option value="+267">ğŸ‡§ğŸ‡¼ +267</option>
              <option value="+268">ğŸ‡¸ğŸ‡¿ +268</option>
              <option value="+269">ğŸ‡°ğŸ‡² +269</option>
              <option value="+290">ğŸ‡¸ğŸ‡­ +290</option>
              <option value="+291">ğŸ‡ªğŸ‡· +291</option>
              <option value="+297">ğŸ‡¦ğŸ‡¼ +297</option>
              <option value="+298">ğŸ‡«ğŸ‡´ +298</option>
            </select>
            <input
              type="tel"
              id="phone-number"
              placeholder="6 12 34 56 78"
              name="customer[phone_number]"
              class="phone-number-input form-control"
              pattern="[0-9\s\-\(\)]+"
              style="flex: 1;"
            >
          </div>
          <!-- Hidden input for phone data that will be saved to customer note -->
          <input type="hidden" name="customer[note]" id="customer-note-hidden" value="">
        </div>
        
        <div class="form-group mb-20 flex flex-column password form-floating">
          <input
            type="password"
            name="customer[password]"
            placeholder="{{ 'customer.login_page.placeholder_pass' | t }}"
            required
            id="password"
             class="form-control"
          >
          <label class="form-label pb-5" for="password">
            {{- 'customer.register.password' | t -}}
            <span class="required">*</span></label
          > 
        </div>
        
        <!-- Marketing Consent Section -->
        <div class="form-group mb-20 marketing-consent">
          <div class="checkbox-group">
            <div class="checkbox-item mb-15">
              <input 
                type="checkbox" 
                id="email-marketing" 
                name="customer[accepts_marketing]" 
                value="1"
                class="marketing-checkbox"
              >
              <label for="email-marketing" class="checkbox-label">
                {{ 'customer.register.email_marketing' | t | default: 'I would like to receive email marketing communications' }}
              </label>
            </div>
            
            {% comment %} <div class="checkbox-item mb-15">
              <input 
                type="checkbox" 
                id="sms-marketing" 
                name="customer[sms_marketing_consent]" 
                value="1"
                class="marketing-checkbox"
              >
              <label for="sms-marketing" class="checkbox-label">
                {{ 'customer.register.sms_marketing' | t | default: 'I would like to receive SMS marketing communications' }}
              </label>
            </div> {% endcomment %}
            
            <div class="checkbox-item mb-15">
              <input 
                type="checkbox" 
                id="fidelite-card" 
                value="fidelite-card-member"
                class="marketing-checkbox"
              >
              <label for="fidelite-card" class="checkbox-label">
                {{ 'customer.register.fidelite_card' | t | default: 'I want to be a fidelite card member' }}
              </label>
            </div>
          </div>
        </div>
        
        <p>
          {% assign policy = shop.privacy_policy.url %}
          {{ 'customer.register.content_form_html' | t: link: policy }}
        </p>
        <div class="submit mt-30 flex flex-column">
          <input class="btn-primary text-center" type="submit" value="{{ 'customer.register.submit' | t }}">
          <a href="{{ routes.account_login_url }}" class="btn btn-outline no-underline w-full text-center mt-20">
            {{ 'customer.login_page.submit' | t }}
          </a>
        </div>
      {% endform %}
      
      <script>
        document.addEventListener('DOMContentLoaded', function() {
          const form = document.querySelector('.custormer-register-form');
          const countrySelect = form.querySelector('select[name="customer[phone_country]"]');
          const phoneNumberInput = form.querySelector('input[name="customer[phone_number]"]');
          const customerNoteInput = form.querySelector('#customer-note-hidden');
          
          // Function to update the customer note with phone information
          function updateCustomerNote() {
            const customerNoteInput = form.querySelector('#customer-note-hidden');
            if (countrySelect && phoneNumberInput && customerNoteInput) {
              const phoneNumber = phoneNumberInput.value.trim();
              
              if (phoneNumber) {
                const combinedPhone = countrySelect.value + phoneNumber.replace(/\s/g, '');
                const noteText = `Phone: ${combinedPhone} (Country: ${countrySelect.value})`;
                customerNoteInput.value = noteText;
                console.log('ğŸ“± Updated customer note:', noteText);
              } else {
                customerNoteInput.value = '';
              }
            }
          }
          
          // Update customer note on country change
          if (countrySelect) {
            countrySelect.addEventListener('change', updateCustomerNote);
          }
          
          // Update customer note on number input
          if (phoneNumberInput) {
            phoneNumberInput.addEventListener('input', updateCustomerNote);
          }
          
          if (form) {
            form.addEventListener('submit', function(e) {
              console.log('ğŸš€ Main registration form submitted!');
              
              // Remove existing tag inputs to avoid duplicates
              const existingTagInputs = form.querySelectorAll('input[name="customer[tags]"]');
              existingTagInputs.forEach(input => input.remove());
              console.log('Removed existing tag inputs:', existingTagInputs.length);
              
              // Ensure customer note is properly set one final time before submission
              updateCustomerNote();
              
              // Handle phone number as tag for easier retrieval
              if (phoneNumberInput && phoneNumberInput.value.trim()) {
                const phoneNumber = phoneNumberInput.value.replace(/\s/g, '');
                const countryCode = countrySelect ? countrySelect.value : '+961';
                const fullPhone = countryCode + phoneNumber;
                
                // Add phone as a tag (prefixed with 'phone:' for easy identification)
                tags.push('phone:' + fullPhone);
                console.log('ğŸ“± Added phone tag:', 'phone:' + fullPhone);
                
                // Verify customer note is set
                const customerNoteInput = form.querySelector('#customer-note-hidden');
                if (customerNoteInput && customerNoteInput.value) {
                  console.log('ğŸ“ Final customer note for submission:', customerNoteInput.value);
                }
              }
              
              // Handle custom tags processing
              const tags = [];
              
              // Check all marketing checkboxes and add corresponding tags
              const emailMarketingCheckbox = document.getElementById('email-marketing');
              const smsMarketingCheckbox = document.getElementById('sms-marketing');
              const fideliteCheckbox = document.getElementById('fidelite-card');
              
              console.log('Email marketing checkbox:', emailMarketingCheckbox);
              if (emailMarketingCheckbox && emailMarketingCheckbox.checked) {
                tags.push('email-marketing-consent');
                console.log('âœ… Added email-marketing-consent tag');
              }
              
              console.log('SMS marketing checkbox:', smsMarketingCheckbox);
              if (smsMarketingCheckbox && smsMarketingCheckbox.checked) {
                tags.push('sms-marketing-consent');
                console.log('âœ… Added sms-marketing-consent tag');
              }
              
              console.log('Fidelite card checkbox:', fideliteCheckbox);
              if (fideliteCheckbox && fideliteCheckbox.checked) {
                tags.push('fidelite-card-member');
                console.log('âœ… Added fidelite-card-member tag');
              }
              
              console.log('ğŸ“‹ Final tags to add:', tags);
              
              // ALWAYS create tag input, even if empty
              const tagInput = document.createElement('input');
              tagInput.type = 'hidden';
              tagInput.name = 'customer[tags]';
              tagInput.value = tags.length > 0 ? tags.join(',') : '';
              form.appendChild(tagInput);
              
              console.log('âœ… Created customer[tags] input with value:', `"${tagInput.value}"`);
              console.log('ğŸ¯ Allowing form to submit to Shopify...');
            });
          }
        });
      </script>
    </div>
  </div>
</div>
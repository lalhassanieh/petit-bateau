{%- liquid
  assign variants_available_arr = product.variants | map: 'available'
  assign variants_option_1_arr = product.variants | map: 'option1'
  assign variants_option_2_arr = product.variants | map: 'option2'
  assign variants_option_3_arr = product.variants | map: 'option3'
  assign product_form_id = 'product-form-' | append: section.id
  
  # Sort size options numerically
  assign sorted_values = option.values
  
  # Check if this option contains size-like values
  assign is_size_option = false
  for val in option.values limit: 2
    assign val_lower = val | downcase | strip
    if val_lower contains 'm' or val_lower contains '-' or val_lower == 'xs' or val_lower == 's' or val_lower == 'l' or val_lower == 'xl' or val_lower == 'xxl' or val_lower == 'xxxl'
      assign is_size_option = true
      break
    endif
    # Check for T-sizes (T0, T1, T2, etc.)
    if val_lower contains 't' and val_lower != 'xs' and val_lower != 'xl' and val_lower != 'xxl' and val_lower != 'xxxl' and val_lower != '3xl'
      assign t_number = val_lower | replace: 't', '' | plus: 0
      if t_number >= 0
        assign is_size_option = true
        break
      endif
    endif
    assign val_number = val | plus: 0
    if val_number > 0
      assign is_size_option = true
      break
    endif
  endfor
  
  # Only sort if this is a size option
  if is_size_option
    # Simple numerical sort for month sizes like 3M, 6M, 12M, 18M, 24M
    assign numerical_sizes = ''
    assign range_sizes = ''
    assign letter_sizes = ''
    assign other_sizes = ''
    
    # Separate different types of sizes
    for val in option.values
      assign val_lower = val | downcase | strip
      
      # Check for T-sizes FIRST (T0, T1, T2, etc.)
      if val_lower contains 't' and val_lower != 'xs' and val_lower != 'xl' and val_lower != 'xxl' and val_lower != 'xxxl' and val_lower != '3xl'
        assign t_number = val_lower | replace: 't', '' | plus: 0
        if t_number >= 0
          if numerical_sizes == ''
            assign numerical_sizes = val | append: ':' | append: t_number
          else
            assign numerical_sizes = numerical_sizes | append: ',' | append: val | append: ':' | append: t_number
          endif
        else
          if other_sizes == ''
            assign other_sizes = val
          else
            assign other_sizes = other_sizes | append: ',' | append: val
          endif
        endif
      # Check for range sizes (like 3-6M, 12-18M, 24-36M)
      elsif val_lower contains '-'
        assign first_number = val_lower | split: '-' | first | plus: 0
        if first_number > 0
          if range_sizes == ''
            assign range_sizes = val | append: ':' | append: first_number
          else
            assign range_sizes = range_sizes | append: ',' | append: val | append: ':' | append: first_number
          endif
        else
          if other_sizes == ''
            assign other_sizes = val
          else
            assign other_sizes = other_sizes | append: ',' | append: val
          endif
        endif
      # Check for single month sizes like 3M, 6M, 12M
      elsif val_lower contains 'm' and val_lower != 'm' and val_lower != 'xl' and val_lower != 'xxl' and val_lower != 'xxxl'
        assign number = val_lower | replace: 'm', '' | plus: 0
        if number > 0
          if numerical_sizes == ''
            assign numerical_sizes = val | append: ':' | append: number
          else
            assign numerical_sizes = numerical_sizes | append: ',' | append: val | append: ':' | append: number
          endif
        else
          if other_sizes == ''
            assign other_sizes = val
          else
            assign other_sizes = other_sizes | append: ',' | append: val
          endif
        endif
      # Check for number+letter sizes like 3A, 4A, 5A, 6A
      elsif val_lower contains 'a' and val_lower != 'xs' and val_lower != 'xl' and val_lower != 'xxl' and val_lower != 'xxxl'
        assign number = val_lower | replace: 'a', '' | plus: 0
        if number > 0
          if numerical_sizes == ''
            assign numerical_sizes = val | append: ':' | append: number
          else
            assign numerical_sizes = numerical_sizes | append: ',' | append: val | append: ':' | append: number
          endif
        else
          if other_sizes == ''
            assign other_sizes = val
          else
            assign other_sizes = other_sizes | append: ',' | append: val
          endif
        endif
      # Check for letter sizes XXS, XS, S, M, L, XL, XXL, 3XL, etc.
      elsif val_lower == 'xxs' or val_lower == 'xs' or val_lower == 's' or val_lower == 'm' or val_lower == 'l' or val_lower == 'xl' or val_lower == 'xxl' or val_lower == 'xxxl' or val_lower == '3xl'
        # Assign numeric values for sorting: XXS=1, XS=2, S=3, M=4, L=5, XL=6, XXL=7, 3XL/XXXL=8
        assign size_order = 0
        if val_lower == 'xxs'
          assign size_order = 1
        elsif val_lower == 'xs'
          assign size_order = 2
        elsif val_lower == 's'
          assign size_order = 3
        elsif val_lower == 'm'
          assign size_order = 4
        elsif val_lower == 'l'
          assign size_order = 5
        elsif val_lower == 'xl'
          assign size_order = 6
        elsif val_lower == 'xxl'
          assign size_order = 7
        elsif val_lower == 'xxxl' or val_lower == '3xl'
          assign size_order = 8
        endif
        
        if letter_sizes == ''
          assign letter_sizes = val | append: ':' | append: size_order
        else
          assign letter_sizes = letter_sizes | append: ',' | append: val | append: ':' | append: size_order
        endif
      else
        if other_sizes == ''
          assign other_sizes = val
        else
          assign other_sizes = other_sizes | append: ',' | append: val
        endif
      endif
    endfor
    
    # Sort numerical sizes (T0, T1, T2, 3M, 6M, 12M, etc.)
    assign sorted_numerical = ''
    if numerical_sizes != ''
      assign num_array = numerical_sizes | split: ','
      # Sort by extracting numbers and ordering them (starting from 0 for T0)
      for i in (0..48)
        for item in num_array
          assign parts = item | split: ':'
          assign item_number = parts[1] | plus: 0
          if item_number == i
            if sorted_numerical == ''
              assign sorted_numerical = parts[0]
            else
              assign sorted_numerical = sorted_numerical | append: ',' | append: parts[0]
            endif
          endif
        endfor
      endfor
    endif
    
    # Sort range sizes (3-6M, 12-18M, etc.)
    assign sorted_ranges = ''
    if range_sizes != ''
      assign range_array = range_sizes | split: ','
      # Sort by extracting first numbers and ordering them
      for i in (1..48)
        for item in range_array
          assign parts = item | split: ':'
          assign item_number = parts[1] | plus: 0
          if item_number == i
            if sorted_ranges == ''
              assign sorted_ranges = parts[0]
            else
              assign sorted_ranges = sorted_ranges | append: ',' | append: parts[0]
            endif
          endif
        endfor
      endfor
    endif
    
    # Sort letter sizes (XXS, XS, S, M, L, XL, XXL, 3XL)
    assign sorted_letters = ''
    if letter_sizes != ''
      assign letter_array = letter_sizes | split: ','
      # Sort by order: XXS=1, XS=2, S=3, M=4, L=5, XL=6, XXL=7, 3XL/XXXL=8
      for i in (1..8)
        for item in letter_array
          assign parts = item | split: ':'
          assign item_order = parts[1] | plus: 0
          if item_order == i
            if sorted_letters == ''
              assign sorted_letters = parts[0]
            else
              assign sorted_letters = sorted_letters | append: ',' | append: parts[0]
            endif
          endif
        endfor
      endfor
    endif

    # Combine all sorted sizes in order: numerical, ranges, letters, others
    assign sorted_values = ''
    if sorted_numerical != ''
      assign sorted_values = sorted_numerical
    endif
    if sorted_ranges != ''
      if sorted_values == ''
        assign sorted_values = sorted_ranges
      else
        assign sorted_values = sorted_values | append: ',' | append: sorted_ranges
      endif
    endif
    if sorted_letters != ''
      if sorted_values == ''
        assign sorted_values = sorted_letters
      else
        assign sorted_values = sorted_values | append: ',' | append: sorted_letters
      endif
    endif
    if other_sizes != ''
      if sorted_values == ''
        assign sorted_values = other_sizes
      else
        assign sorted_values = sorted_values | append: ',' | append: other_sizes
      endif
    endif
    
    # Convert back to array
    if sorted_values != ''
      assign sorted_values = sorted_values | split: ','
    else
      assign sorted_values = option.values
    endif
  endif
-%}
{%- for value in sorted_values -%}
  {%- liquid
    assign option_disabled = true
    for option1_name in variants_option_1_arr
      case option.position
        when 1
          if variants_option_1_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
            assign option_disabled = false
          endif
        when 2
          if option1_name == product.selected_or_first_available_variant.option1 and variants_option_2_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
            assign option_disabled = false
          endif
        when 3
          if option1_name == product.selected_or_first_available_variant.option1 and variants_option_2_arr[forloop.index0] == product.selected_or_first_available_variant.option2 and variants_option_3_arr[forloop.index0] == value and variants_available_arr[forloop.index0]
            assign option_disabled = false
          endif
      endcase
    endfor
  -%}
  {% if variant_type == 'dropdown' %}
    <swatch-dropdown-item class="block text-color hover-heading-color transition body_weight">
      <input
        type="radio"
        id="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}"
        name="{{ option.name }}"
        value="{{ value | escape }}"
        form="{{ product_form_id }}"
        {% if option.selected_value == value %}
          checked
        {% endif %}
        class="{% if option_disabled -%}option-disabled{%- endif %} visually-hidden"
      >
      {%- liquid
        assign op = 'option' | append: option.position
        assign variant = product.variants | where: op, value
        assign img = ''
        for i in variant
          if i.featured_image.src
            assign img = i.featured_image.src
            break
          endif
        endfor
      -%}
      <label
        for="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}"
        value="{{ value | escape }}"
        data-value="{{ value | replace: '"', "'" }}"
        {% if option.selected_value == value %}
          selected="selected"
        {% endif %}
        data-option-swatch-value="{{ value }}"
        class="product__color-swatches--js w-full rounded-3 px-15 h-45 inline-flex align-center capitalize"
      >
        {% if option_disabled -%}
          {{- 'products.product.value_unavailable' | t: option_value: value -}}
        {%- else -%}
          {{- value -}}
        {%- endif %}
      </label>
    </swatch-dropdown-item>
  {% else %}
    <input
      type="radio"
      id="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}"
      name="{{ option.name }}"
      value="{{ value | escape }}"
      form="{{ product_form_id }}"
      {% if option.selected_value == value %}
        checked
      {% endif %}
      class="{% if option_disabled -%}option-disabled {%- endif %} visually-hidden"
    >
    {%- if isColorOption != true or settings.enable_color_swatches == false -%}
      <label
        class="tooltip pointer product__color-swatches--js product__item-option inline-flex align-center border rounded-3 subheading_weight btn-hover lh-normal px-20 py-10 transition relative"
        for="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}"
      >
        <span class="relative z-2 uppercase-first-letter">
          {{ value -}}
        </span>
      </label>
    {%- else -%}
      {%- liquid
        assign op = 'option' | append: option.position
        assign variant = product.variants | where: op, value
        assign img = ''
        for i in variant
          if i.featured_image.src
            assign img = i.featured_image.src
            break
          endif
        endfor

        if value.swatch.image
          assign image_url = value.swatch.image | image_url
          assign swatch_value = 'url(' | append: image_url | append: ')'
        elsif value.swatch.color
          assign swatch_value = 'rgb(' | append: value.swatch.color.rgb | append: ')'
        else
          assign swatch_value = null
        endif
      -%}
      <label
        class="product__color-swatches--js relative tooltip product__color-swatch inline-flex align-center rounded-50 swatch-large pointer"
        for="{{ section.id }}-{{ option.position }}-{{ forloop.index0 }}"
        data-value="{{ value | replace: '"', "'" }}"
        data-color="{{ value | downcase | replace: ' ', '-' | replace: '"', "'" }}"
        data-custom-value="custom__color-swatches--{{ value | downcase | replace: ' ', '-' | replace: '"', "'" }}"
        data-swatch-type="{{ swatch_item_type }}"
        data-position="{{ option.position }}"
        {% if img != blank %}
          data-image="{{ img | image_url }}"
        {% endif %}
        data-option-swatch-value="{{ swatch_value }}"
      >
        <span class="tooltip-content invisible rounded-3 absolute pointer-none">{{ value }}</span>
      </label>
    {%- endif -%}
  {% endif %}
{%- endfor -%}

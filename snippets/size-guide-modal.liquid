{%- comment -%}
  Size Guide Modal - Petit Bateau Style
  Usage: {% render 'size-guide-modal' %}
{%- endcomment -%}

{%- assign unique_id = 'size-guide-' | append: section.id | append: '-' | append: forloop.index0 | default: 'main' -%}

<!-- Size Guide Trigger Button -->
<button id="{{ unique_id }}-trigger" class="size-guide-btn" type="button">
  <svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="size-guide-icon">
    <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm1 13H7v-2h2v2zm0-3H7V4h2v6z" fill="currentColor"/>
  </svg>
  Guide des tailles
</button>

<!-- Size Guide Modal Structure -->
<div id="{{ unique_id }}-modal" class="size-guide-modal" role="dialog" aria-labelledby="{{ unique_id }}-title" aria-hidden="true">
  <div class="size-guide-modal-overlay"></div>
  <div class="size-guide-modal-content">
    <div class="size-guide-header">
      <h2 id="{{ unique_id }}-title" class="size-guide-title">Guide des tailles</h2>
      <button type="button" class="size-guide-close" id="{{ unique_id }}-close" aria-label="Fermer le guide des tailles">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
    
    <div class="size-guide-body">
      <!-- Dynamic Content Based on Product Type -->
      {%- if product.type contains 'Gigoteuse' or product.title contains 'Gigoteuse' -%}
        <!-- Sleeping Bag Size Guide -->
        <div class="size-guide-table-wrapper">
          <table class="size-guide-table">
            <thead>
              <tr>
                <th>Taille</th>
                <th>Âge</th>
                <th>Hauteur (cm)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>T0</strong></td>
                <td>Naissance/6 mois</td>
                <td>63,2 cm</td>
              </tr>
              <tr>
                <td><strong>T1</strong></td>
                <td>6/18 mois</td>
                <td>77,9 cm</td>
              </tr>
              <tr>
                <td><strong>T2</strong></td>
                <td>18/36 mois</td>
                <td>91,9 cm</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div class="size-guide-info">
          <h3>Information TOG</h3>
          <p><strong>TOG :</strong> Bien choisir les vêtements à faire porter à votre bébé selon la température de la chambre.</p>
          <ul>
            <li><strong>Moins de 1,0 TOG :</strong> température de chambre entre 22°C et 27°C</li>
            <li><strong>1 à 2 TOG :</strong> température de chambre entre 18°C et 22°C</li>
            <li><strong>2 à 3 TOG :</strong> température de chambre entre 16°C et 18°C</li>
            <li><strong>3 à 3,5 TOG :</strong> température de chambre entre 13°C et 16°C</li>
          </ul>
          <p class="size-guide-note">
            <strong>Note :</strong> Les tailles 6/18 et 18/36 mois sont réglables sur la longueur, avec des pressions cachées.
          </p>
        </div>
      
      {%- elsif product.type contains 'Bébé' or product.collections contains collections['bebe'] -%}
        <!-- Baby Clothing Size Guide -->
        <div class="size-guide-table-wrapper">
          <table class="size-guide-table">
            <thead>
              <tr>
                <th>Taille</th>
                <th>Âge</th>
                <th>Poids (kg)</th>
                <th>Hauteur (cm)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>1M</strong></td>
                <td>1 mois</td>
                <td>3-5</td>
                <td>50-56</td>
              </tr>
              <tr>
                <td><strong>3M</strong></td>
                <td>3 mois</td>
                <td>5-6</td>
                <td>56-62</td>
              </tr>
              <tr>
                <td><strong>6M</strong></td>
                <td>6 mois</td>
                <td>6-8</td>
                <td>62-68</td>
              </tr>
              <tr>
                <td><strong>12M</strong></td>
                <td>12 mois</td>
                <td>8-10</td>
                <td>68-74</td>
              </tr>
              <tr>
                <td><strong>18M</strong></td>
                <td>18 mois</td>
                <td>10-12</td>
                <td>74-81</td>
              </tr>
              <tr>
                <td><strong>24M</strong></td>
                <td>24 mois</td>
                <td>12-14</td>
                <td>81-86</td>
              </tr>
            </tbody>
          </table>
        </div>
      
      {%- else -%}
        <!-- General Children Size Guide -->
        <div class="size-guide-table-wrapper">
          <table class="size-guide-table">
            <thead>
              <tr>
                <th>Taille</th>
                <th>Âge</th>
                <th>Hauteur (cm)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>3A</strong></td>
                <td>3 ans</td>
                <td>94-100</td>
              </tr>
              <tr>
                <td><strong>4A</strong></td>
                <td>4 ans</td>
                <td>100-106</td>
              </tr>
              <tr>
                <td><strong>5A</strong></td>
                <td>5 ans</td>
                <td>106-112</td>
              </tr>
              <tr>
                <td><strong>6A</strong></td>
                <td>6 ans</td>
                <td>112-118</td>
              </tr>
              <tr>
                <td><strong>8A</strong></td>
                <td>8 ans</td>
                <td>118-128</td>
              </tr>
              <tr>
                <td><strong>10A</strong></td>
                <td>10 ans</td>
                <td>128-138</td>
              </tr>
              <tr>
                <td><strong>12A</strong></td>
                <td>12 ans</td>
                <td>138-148</td>
              </tr>
            </tbody>
          </table>
        </div>
      {%- endif -%}
      
      <div class="size-guide-tips">
        <h3>Conseils de mesure</h3>
        <p>Pour choisir la bonne taille, mesurez votre enfant et référez-vous au tableau ci-dessus. En cas d'hésitation entre deux tailles, choisissez la taille supérieure.</p>
      </div>
    </div>
  </div>
</div>

<!-- Size Guide Styles -->
<style>
.size-guide-btn {
  background: transparent;
  color: #666;
  border: 1px solid #ddd;
  border-radius: 4px;
  padding: 8px 12px;
  font-size: 14px;
  font-weight: 400;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  transition: all 0.2s ease;
  text-decoration: none;
  margin-top: 8px;
}

.size-guide-btn:hover {
  background: #f5f5f5;
  border-color: #ccc;
  color: #333;
}

.size-guide-icon {
  width: 16px;
  height: 16px;
  flex-shrink: 0;
}

.size-guide-modal {
  display: none;
  position: fixed;
  z-index: 9999;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.size-guide-modal.show {
  opacity: 1;
}

.size-guide-modal-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  cursor: pointer;
}

.size-guide-modal-content {
  background: #fff;
  margin: 40px auto;
  border-radius: 8px;
  max-width: 520px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  position: relative;
  z-index: 1;
  animation: slideIn 0.3s ease;
}

@keyframes slideIn {
  from {
    transform: translateY(-20px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.size-guide-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 24px;
  border-bottom: 1px solid #eee;
}

.size-guide-title {
  font-size: 20px;
  font-weight: 600;
  margin: 0;
  color: #333;
}

.size-guide-close {
  background: none;
  border: none;
  cursor: pointer;
  color: #666;
  padding: 4px;
  border-radius: 4px;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.size-guide-close:hover {
  background: #f5f5f5;
  color: #333;
}

.size-guide-body {
  padding: 24px;
}

.size-guide-table-wrapper {
  margin-bottom: 24px;
  overflow-x: auto;
}

.size-guide-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

.size-guide-table th,
.size-guide-table td {
  border: 1px solid #ddd;
  padding: 12px 8px;
  text-align: center;
  vertical-align: middle;
}

.size-guide-table th {
  background: #f8f9fa;
  font-weight: 600;
  color: #333;
  font-size: 13px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.size-guide-table td {
  color: #555;
}

.size-guide-table tbody tr:nth-child(even) {
  background: #fafafa;
}

.size-guide-table tbody tr:hover {
  background: #f0f0f0;
}

.size-guide-info h3,
.size-guide-tips h3 {
  font-size: 16px;
  font-weight: 600;
  margin: 0 0 12px 0;
  color: #333;
}

.size-guide-info,
.size-guide-tips {
  margin-bottom: 20px;
}

.size-guide-info p,
.size-guide-tips p {
  font-size: 14px;
  line-height: 1.5;
  color: #555;
  margin: 0 0 12px 0;
}

.size-guide-info ul {
  margin: 12px 0 0 0;
  padding: 0 0 0 20px;
  list-style-type: disc;
}

.size-guide-info li {
  font-size: 14px;
  line-height: 1.4;
  color: #555;
  margin-bottom: 6px;
}

.size-guide-note {
  background: #f8f9fa;
  padding: 12px;
  border-radius: 4px;
  border-left: 3px solid #007bff;
  font-size: 13px !important;
  margin-top: 16px !important;
}

/* Mobile Responsive */
@media (max-width: 600px) {
  .size-guide-modal-content {
    margin: 20px auto;
    width: 95%;
    max-height: 95vh;
  }
  
  .size-guide-header {
    padding: 16px 20px;
  }
  
  .size-guide-title {
    font-size: 18px;
  }
  
  .size-guide-body {
    padding: 20px;
  }
  
  .size-guide-table th,
  .size-guide-table td {
    padding: 8px 6px;
    font-size: 13px;
  }
  
  .size-guide-btn {
    font-size: 13px;
    padding: 6px 10px;
  }
}

/* Accessibility */
.size-guide-modal[aria-hidden="true"] {
  display: none;
}

.size-guide-modal[aria-hidden="false"] {
  display: block;
}

/* Focus styles for keyboard navigation */
.size-guide-btn:focus,
.size-guide-close:focus {
  outline: 2px solid #007bff;
  outline-offset: 2px;
}
</style>

<!-- Size Guide JavaScript -->
<script>
(function() {
  'use strict';
  
  const uniqueId = '{{ unique_id }}';
  const modal = document.getElementById(uniqueId + '-modal');
  const trigger = document.getElementById(uniqueId + '-trigger');
  const closeBtn = document.getElementById(uniqueId + '-close');
  const overlay = modal?.querySelector('.size-guide-modal-overlay');
  
  if (!modal || !trigger || !closeBtn) return;
  
  // Open modal
  function openModal() {
    modal.style.display = 'block';
    modal.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
    
    // Add show class for animation
    requestAnimationFrame(() => {
      modal.classList.add('show');
    });
    
    // Focus management
    closeBtn.focus();
    
    // Trap focus within modal
    trapFocus(modal);
  }
  
  // Close modal
  function closeModal() {
    modal.classList.remove('show');
    
    setTimeout(() => {
      modal.style.display = 'none';
      modal.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
      trigger.focus(); // Return focus to trigger
    }, 300);
  }
  
  // Focus trap helper
  function trapFocus(element) {
    const focusableElements = element.querySelectorAll(
      'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
    );
    const firstElement = focusableElements[0];
    const lastElement = focusableElements[focusableElements.length - 1];
    
    element.addEventListener('keydown', function(e) {
      if (e.key === 'Tab') {
        if (e.shiftKey) {
          if (document.activeElement === firstElement) {
            lastElement.focus();
            e.preventDefault();
          }
        } else {
          if (document.activeElement === lastElement) {
            firstElement.focus();
            e.preventDefault();
          }
        }
      }
    });
  }
  
  // Event listeners
  trigger.addEventListener('click', openModal);
  closeBtn.addEventListener('click', closeModal);
  overlay?.addEventListener('click', closeModal);
  
  // Close on Escape key - only if this modal is open
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && modal.style.display === 'block') {
      closeModal();
    }
  });
  
  // Prevent modal content clicks from closing modal
  modal.querySelector('.size-guide-modal-content')?.addEventListener('click', function(e) {
    e.stopPropagation();
  });
})();
</script>